<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Point of Sale</title>

    <!-- Custom fonts for this template -->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link href="css/sb-admin-2.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/img-ratio.css">
    <link rel="stylesheet" href="css/pos.css">
    <link href="vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
</head>

<body id="page-top">
    <div id="wrapper">
        <?php include './include/sidebar.php' ?>
        <div id="content-wrapper" class="d-flex flex-column">
            <div id="content">
                <?php include './include/topbar.php' ?>
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="d-sm-flex align-items-center justify-content-between mb-4">
                                <h1 class="h3 mb-0 text-gray-800">POS</h1>
                                <div class="search-box">
                                    <button class="btn-search"><i class="fas fa-search"></i></button>
                                    <input type="text" class="input-search" placeholder="Type to Search...">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-2">
                            <select class="form-select">
                                <option selected>Table</option>
                                <option value="t1">Table 1</option>
                                <option value="t2">Table 2</option>
                                <option value="t3">Table 3</option>
                                <option value="t4">Table 4</option>
                                <option value="t5">Table 5</option>
                                <option value="t6">Table 6</option>
                                <option value="t7">Table 7</option>
                                <option value="t8">Table 8</option>
                            </select>
                        </div>
                        <div class="col-lg-2">
                            <select class="form-select">
                                <option selected>Outlet</option>
                                <option value="o1">Sen Sok</option>
                                <option value="o2">Toul Kork</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-8">
                            <ul class="nav nav-tabs" id="itemGroupTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="beverages-tab" data-bs-toggle="tab" data-bs-target="#beverages" type="button" role="tab" aria-controls="beverages" aria-selected="true">Beverages</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="snacks-tab" data-bs-toggle="tab" data-bs-target="#snacks" type="button" role="tab" aria-controls="snacks" aria-selected="false">Snacks</button>
                                </li>
                            </ul>
                            <div class="tab-content" id="itemGroupTabsContent">
                                <div class="tab-pane fade show active" id="beverages" role="tabpanel" aria-labelledby="beverages-tab">
                                    <div class="row">
                                        <div class="col-lg-3">
                                            <div class="card border-0">
                                                <div class="thumbnail-wrapper">
                                                    <div class="thumbnail-inner img4by3">
                                                        <img src="https://images.ctfassets.net/v601h1fyjgba/4GLzOncHIe8rq3xY099cZ/dd17ce72ebb6fb01659c763fe64953db/Iced_Latte.jpg" class="rounded" alt="...">
                                                    </div>
                                                </div>
                                                <div class="card-body">
                                                    <p class="card-text">Iced Latte</p>
                                                    <h5 class="text-success">$3.00</h5>
                                                    <button class="btn btn-primary add-to-cart" data-item="Iced Latte" data-price="3.00"><i class="fas fa-plus"></i> Add</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-3">
                                            <div class="card border-0">
                                                <div class="thumbnail-wrapper">
                                                    <div class="thumbnail-inner img4by3">
                                                        <img src="https://images.ctfassets.net/v601h1fyjgba/6TroCkgvDucbXj1OSPeve5/7cfeb09a7498e59bd7a48c4e048d2cec/Lite_Iced_Cappuccino_Hi.jpg" class="rounded" alt="...">
                                                    </div>
                                                </div>
                                                <div class="card-body">
                                                    <p class="card-text">Iced Cappuccino</p>
                                                    <h5 class="text-success">$3.00</h5>
                                                    <button class="btn btn-primary add-to-cart" data-item="Iced Cappuccino" data-price="3.00"><i class="fas fa-plus"></i> Add</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="snacks" role="tabpanel" aria-labelledby="snacks-tab">
                                    <div class="row">
                                        <div class="col-lg-3">
                                            <div class="card border-0">
                                                <div class="thumbnail-wrapper">
                                                    <div class="thumbnail-inner img4by3">
                                                        <img src="https://example.com/snack1.jpg" class="rounded" alt="...">
                                                    </div>
                                                </div>
                                                <div class="card-body">
                                                    <p class="card-text">Snack 1</p>
                                                    <h5 class="text-success">$2.00</h5>
                                                    <button class="btn btn-primary add-to-cart" data-item="Snack 1" data-price="2.00"><i class="fas fa-plus"></i> Add</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-3">
                                            <div class="card border-0">
                                                <div class="thumbnail-wrapper">
                                                    <div class="thumbnail-inner img4by3">
                                                        <img src="https://example.com/snack2.jpg" class="rounded" alt="...">
                                                    </div>
                                                </div>
                                                <div class="card-body">
                                                    <p class="card-text">Snack 2</p>
                                                    <h5 class="text-success">$2.50</h5>
                                                    <button class="btn btn-primary add-to-cart" data-item="Snack 2" data-price="2.50"><i class="fas fa-plus"></i> Add</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 bg-white py-4 rounded">
                            <div id="order-details">
                                <h5>Order Details</h5>
                                <ul id="order-list" class="list-group"></ul>
                                <hr>
                                <div>
                                    <label for="discount" class="form-label">Discount (%):</label>
                                    <input type="number" id="discount" class="form-control" value="0">
                                    <div class="mt-2">
                                        <button class="btn btn-outline-primary btn-sm discount-btn" data-discount="5">5%</button>
                                        <button class="btn btn-outline-primary btn-sm discount-btn" data-discount="10">10%</button>
                                        <button class="btn btn-outline-primary btn-sm discount-btn" data-discount="15">15%</button>
                                        <button class="btn btn-outline-primary btn-sm discount-btn" data-discount="20">20%</button>
                                        <button class="btn btn-outline-primary btn-sm discount-btn" data-discount="25">25%</button>
                                        <button class="btn btn-outline-primary btn-sm discount-btn" data-discount="30">30%</button>
                                        <button class="btn btn-outline-primary btn-sm discount-btn" data-discount="40">40%</button>
                                        <button class="btn btn-outline-primary btn-sm discount-btn" data-discount="50">50%</button>
                                        <button class="btn btn-outline-primary btn-sm discount-btn" data-discount="100">100%</button>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <label for="discount-amount" class="form-label">Discount ($):</label>
                                    <input type="number" id="discount-amount" class="form-control" value="0">
                                </div>
                                <hr>
                                <div class="d-flex justify-content-between">
                                    <h5>Total:</h5>
                                    <h5 id="total-price">$0.00</h5>
                                </div>
                                <button class="btn btn-success mt-3" id="checkout" data-bs-toggle="modal" data-bs-target="#paymentModal">Checkout</button>
                                <button class="btn btn-secondary mt-3" id="print-receipt">Print Receipt</button>
                            </div>
                            <div id="receipt-preview" style="display: none;">
                                <h5 class="text-center">Receipt</h5>
                                <ul id="receipt-list" class="list-group"></ul>
                                <hr>
                                <div class="d-flex justify-content-between">
                                    <h5>Total:</h5>
                                    <h5 id="receipt-total">$0.00</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

<!-- Payment Modal -->
<div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="paymentModalLabel">Payment Summary</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Summary Details -->
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>Before Discount Total:</span>
                        <span id="modal-before-discount">$0.00</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>Discount Percentage:</span>
                        <span id="modal-discount-percentage">0%</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>Discount Amount:</span>
                        <span id="modal-discount-amount">$0.00</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>Total After Discount:</span>
                        <span id="modal-total-after-discount">$0.00</span>
                    </div>
                </div>

                <!-- Payment Method -->
                <div class="mb-3">
                    <label for="payment-method" class="form-label">Payment Method:</label>
                    <select id="payment-method" class="form-select">
                        <option value="cash-usd" selected>Cash USD</option>
                        <option value="aba-bank">ABA Bank</option>
                        <option value="acleda-bank">ACLEDA Bank</option>
                    </select>
                </div>

                <!-- Payment Input -->
                <div class="mb-3">
                    <label for="payment-received" class="form-label">Payment Received:</label>
                    <input type="number" id="payment-received" class="form-control" placeholder="Enter amount received">
                </div>

                <!-- Quick Payment Buttons -->
                <div class="mb-3">
                    <h6>Quick Payment:</h6>
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-secondary quick-payment" data-value="1">1$</button>
                        <button type="button" class="btn btn-secondary quick-payment" data-value="2">2$</button>
                        <button type="button" class="btn btn-secondary quick-payment" data-value="5">5$</button>
                        <button type="button" class="btn btn-secondary quick-payment" data-value="10">10$</button>
                        <button type="button" class="btn btn-secondary quick-payment" data-value="20">20$</button>
                        <button type="button" class="btn btn-secondary quick-payment" data-value="50">50$</button>
                        <button type="button" class="btn btn-secondary quick-payment" data-value="100">100$</button>
                    </div>
                </div>

                <!-- Change -->
                <div class="d-flex justify-content-between mt-3">
                    <span>Change:</span>
                    <span id="modal-change">$0.00</span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="finalize-payment">Finalize Payment</button>
            </div>
        </div>
    </div>
</div>

        <script>
document.addEventListener('DOMContentLoaded', () => {
    const cart = [];
    const orderList = document.getElementById('order-list');
    const totalPrice = document.getElementById('total-price');
    const discountInput = document.getElementById('discount');
    const discountAmountInput = document.getElementById('discount-amount'); //new
    const discountButtons = document.querySelectorAll('.discount-btn'); //new
    const totalPriceElement = document.getElementById('total-price'); //new
    const paymentModal = new bootstrap.Modal(document.getElementById('paymentModal'));
    const modalBeforeDiscount = document.getElementById('modal-before-discount');
    const modalDiscountPercentage = document.getElementById('modal-discount-percentage');
    const modalDiscountAmount = document.getElementById('modal-discount-amount');
    const modalTotalAfterDiscount = document.getElementById('modal-total-after-discount');
    const paymentReceivedInput = document.getElementById('payment-received');
    const modalChange = document.getElementById('modal-change');

    // function updateCart() {
    //     orderList.innerHTML = '';
    //     let total = 0;
    //     cart.forEach((item, index) => {
    //         total += item.price * item.quantity;
    //         const li = document.createElement('li');
    //         li.classList.add('list-group-item');
    //         li.innerHTML = `${item.name} x${item.quantity} - $${(item.price * item.quantity).toFixed(2)} <button class='btn btn-danger btn-sm float-end' onclick='removeItem(${index})'>Remove</button>`;
    //         orderList.appendChild(li);
    //     });

    //     const discount = parseFloat(discountInput.value) || 0;
    //     const discountAmount = total * (discount / 100);
    //     const discountedTotal = total - discountAmount;

    //     totalPrice.textContent = `$${discountedTotal.toFixed(2)}`;
        
    // }

    function updateCart() {
        orderList.innerHTML = '';
        let total = 0;
        cart.forEach((item, index) => {
            total += item.price * item.quantity;
            const li = document.createElement('li');
            li.classList.add('list-group-item');
            li.innerHTML = `${item.name} x${item.quantity} - $${(item.price * item.quantity).toFixed(2)} <button class='btn btn-danger btn-sm float-end' onclick='removeItem(${index})'>Remove</button>`;
            orderList.appendChild(li);
        });

        const discountPercentage = parseFloat(discountInput.value) || 0;
        const discountByAmount = parseFloat(discountAmountInput.value) || 0;

        let discountFromPercentage = total * (discountPercentage / 100);
        let discountedTotal = total - discountFromPercentage - discountByAmount;

        discountedTotal = Math.max(discountedTotal, 0); // Ensure total is not negative

        totalPrice.textContent = `$${discountedTotal.toFixed(2)}`;
    }

    function removeItem(index) {
        cart.splice(index, 1);
        updateCart();
    }

    document.querySelectorAll('.add-to-cart').forEach(button => {
        button.addEventListener('click', () => {
            const itemName = button.getAttribute('data-item');
            const itemPrice = parseFloat(button.getAttribute('data-price'));
            const existingItem = cart.find(item => item.name === itemName);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({ name: itemName, price: itemPrice, quantity: 1 });
            }

            updateCart();
        });
    });

    // discountInput.addEventListener('input', updateCart);
    discountInput.addEventListener('input', updateCart);
    discountAmountInput.addEventListener('input', updateCart);

    discountButtons.forEach(button => {
        button.addEventListener('click', () => {
            const percentage = parseFloat(button.getAttribute('data-discount'));
            discountInput.value = percentage;
            updateCart();
        });
    });

    document.getElementById('checkout').addEventListener('click', () => {
        // const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
        // const discount = parseFloat(discountInput.value) || 0;
        // const discountAmount = total * (discount / 100);
        // const totalAfterDiscount = total - discountAmount;

        const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
        const discount = parseFloat(discountInput.value) || 0;
        const discountAmount = parseFloat(discountAmountInput.value) || 0;
        const discountFromPercentage = total * (discount / 100);
        const totalAfterDiscount = total - discountFromPercentage - discountAmount;

        modalBeforeDiscount.textContent = `$${total.toFixed(2)}`;
        modalDiscountPercentage.textContent = `${discount}%`;
        modalDiscountAmount.textContent = `$${discountAmount.toFixed(2)}`;
        modalTotalAfterDiscount.textContent = `$${totalAfterDiscount.toFixed(2)}`;
    });

    document.querySelectorAll('.quick-payment').forEach(button => {
        button.addEventListener('click', () => {
            const value = parseFloat(button.getAttribute('data-value'));
            const current = parseFloat(paymentReceivedInput.value) || 0;
            paymentReceivedInput.value = current + value;
            paymentReceivedInput.dispatchEvent(new Event('input'));
        });
    });

    paymentReceivedInput.addEventListener('input', () => {
        const received = parseFloat(paymentReceivedInput.value) || 0;
        const totalAfterDiscount = parseFloat(modalTotalAfterDiscount.textContent.replace('$', ''));
        const change = received - totalAfterDiscount;

        modalChange.textContent = `$${change.toFixed(2)}`;
    });

    document.getElementById('finalize-payment').addEventListener('click', () => {
        alert('Payment finalized!');
        paymentModal.hide();
    });
});

        </script>
</body>

</html>
